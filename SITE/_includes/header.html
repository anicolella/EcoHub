<!-- Header include (EcoHub) -->
<script>
  (function () {
    const log = (...a) => console.debug("[EcoHub]", ...a);
    const qs  = (sel, root=document) => root.querySelector(sel);

    // 1) Garante que a gaveta exista (cria se faltar)
    function ensureDrawerDOM() {
      let drawer  = qs('#drawer');
      let overlay = qs('#drawer-overlay');

      if (!drawer) {
        drawer = document.createElement('aside');
        drawer.id = 'drawer';
        drawer.className = 'drawer';
        drawer.setAttribute('aria-label', 'Menu lateral');
        drawer.setAttribute('aria-hidden', 'true');
        drawer.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #e5e7eb;">
            <strong>Menu EcoHub</strong>
            <button id="drawer-close" aria-label="Fechar menu lateral" style="font-size:20px;line-height:1;border:0;background:none;cursor:pointer">âœ•</button>
          </div>
          <nav style="padding:16px 20px">
            <ul class="drawer-menu">
              <li><a href="#" class="menu-link">ğŸŒ± Cursos</a></li>
              <li><a href="#" class="menu-link">ğŸ“¦ Pacotes (R / Python)</a></li>
              <li><a href="#" class="menu-link">ğŸ“Š Dashboards</a></li>
              <li><a href="#" class="menu-link">ğŸ›°ï¸ Dados Geoespaciais</a></li>
              <li><a href="#" class="menu-link">ğŸ§ª LaboratÃ³rio EcoHub</a></li>
              <li><a href="#" class="menu-link">âš™ï¸ ConfiguraÃ§Ãµes</a></li>
            </ul>
          </nav>`;
        document.body.appendChild(drawer);
      }

      if (!overlay) {
        overlay = document.createElement('div');
        overlay.id = 'drawer-overlay';
        overlay.className = 'drawer-overlay';
        overlay.setAttribute('aria-hidden', 'true');
        document.body.appendChild(overlay);
      }
      return { drawer, overlay };
    }

    // 2) AÃ§Ãµes do drawer
    function openDrawer() {
      const { drawer, overlay } = ensureDrawerDOM();
      drawer.classList.add('open');
      drawer.setAttribute('aria-hidden', 'false');
      overlay.classList.add('show');
      overlay.setAttribute('aria-hidden', 'false');
    }
    function closeDrawer() {
      const drawer  = qs('#drawer');
      const overlay = qs('#drawer-overlay');
      if (!drawer || !overlay) return;
      drawer.classList.remove('open');
      drawer.setAttribute('aria-hidden', 'true');
      overlay.classList.remove('show');
      overlay.setAttribute('aria-hidden', 'true');
    }

    // Expor para testes no console
    window.__eco_openDrawer  = openDrawer;
    window.__eco_closeDrawer = closeDrawer;

    // 3) Intercepta o clique no sanduÃ­che (capturing) e abre a gaveta
    const TRIGGER = ".quarto-navbar-tools a[aria-label='Menu'], .quarto-navbar-tools i.bi.bi-list, .quarto-navbar-tools .quarto-navigation-tool";
    document.addEventListener('click', function (e) {
      const t = e.target.closest(TRIGGER);
      if (!t) return;
      e.preventDefault(); e.stopPropagation();
      const a = t.closest('a');
      if (a) { a.setAttribute('href', 'javascript:void(0)'); a.setAttribute('role','button'); a.style.cursor='pointer'; }
      openDrawer();
    }, true);

    // 4) Fechar por overlay, X e ESC (delegaÃ§Ã£o)
    document.addEventListener('click', (e) => {
      if (e.target.closest('#drawer-overlay') || e.target.closest('#drawer-close')) {
        e.preventDefault(); closeDrawer();
      }
    });
    window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // 5) Garante DOM pronto e cria a estrutura se faltar
    function init() {
      ensureDrawerDOM();
      log("header.html carregado e drawer garantido");
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>
